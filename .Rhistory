dev.off()
#dev.off()
ggsave(file.path(getwd(), "Assignment 2/figs/residualplot_poisson.png"), width = 20, height = 10, units = "cm")
#dev.off()
ggsave(file.path(getwd(), "Assignment 2/figs/residualplot_poisson.png"), width = 20, height = 10, units = "cm")
png(filename = file.path(getwd(),"Assignment 2/figs/residualplot_poisson.png"), width = 20, height = 10, units = "cm", res = 1000)
grid.arrange(first, third, second, fourth, nrow = 2)
dev.off()
rm(list=ls())
library(GGally)
library(qqplotr)
library(corrplot)
library(car)
library(reshape)
library(tidyverse)
library(magrittr)
library(dplyr)
library(betareg)
library(statmod)
library(jtools)
library(numDeriv)
library(latex2exp)
library(broom.mixed)
library(gridExtra)
library(grid)
library(lattice)
library(ggplot2)
library(caret)
library(stringr)
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/")
figpath <- "/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/figs/"
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2")
figpath <- "~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2/figs/"
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/")
figpath <- "C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/"
}
clothing <- read.csv(file = "clothing.csv", header = T)
#### Clothing ####
#1)
c.data <- dplyr::select(clothing, -subjId, -day, -time, -X)
head(c.data)
melt(c.data) %>%
ggplot()+
geom_histogram(aes(x = value, fill = sex), position = "identity", alpha = 0.4)+
scale_fill_manual(values = c("blue", "orange"))+
facet_wrap(~variable, scales = "free")+
theme_bw()
ggsave(paste0(figpath,"clothing_data_histograms.png"), width = 30, height = 10, units = "cm")
################################ 1) Distributions ################################
beta.dist <- function(theta){
return(-sum(dbeta(c.data$clo, shape1 = theta[1], shape2 = theta[2], log = T)))
}
norm.dist <- function(theta){
return(-sum(dnorm(c.data$clo, mean = theta[1], sd = theta[2], log = T)))
}
gamma.dist <- function(theta){
return(-sum(dgamma(c.data$clo, shape = theta[1], rate = theta[2], log = T)))
}
invgaus.dist <- function(theta){
return(-sum(dinvgauss(c.data$clo, mean = theta[1], dispersion = theta[2], log =T)))
}
lnorm.dist <- function(theta){
return(-sum(dlnorm(x=c.data$clo, meanlog = theta[1], sdlog = theta[2], log = T)))
}
beta.hat <- nlminb(start = c(1,1), objective = beta.dist)
norm.hat <- nlminb(start = c(1,1), objective = norm.dist)
gamma.hat <- nlminb(start = c(1,1), objective = gamma.dist)
invgaus.hat <- nlminb(start = c(1,1), objective = invgaus.dist)
lnorm.hat <- nlminb(start = c(1,1), objective = lnorm.dist)
ggplot(c.data)+
geom_histogram(aes(x = clo, y = after_stat(density)), colour = "white",
position = "identity", alpha = 0.4)+
scale_fill_manual(values = c("blue", "orange"))+
stat_function(aes(colour = "1: beta"), fun = dbeta,
args = list(shape1 = beta.hat$par[1],
shape2 = beta.hat$par[2]))+
stat_function(aes(colour = "2: normal"), fun = dnorm,
args = list(mean = norm.hat$par[1],
sd = norm.hat$par[2]))+
stat_function(aes(colour = "3: gamma"), fun = dgamma,
args = list(shape = gamma.hat$par[1],
rate = gamma.hat$par[2]))+
stat_function(aes(colour = "4: gamma"), fun = dinvgauss,
args = list(mean = invgaus.hat$par[1],
dispersion = invgaus.hat$par[2]))+
stat_function(aes(colour = "5: log-normal"), fun = dlnorm,
args = list(meanlog = lnorm.hat$par[1],
sdlog = lnorm.hat$par[2]))+
theme_bw()+
labs(y = "", colour = "Distribution")+
scale_colour_manual(
values = c("blue", "orange", "black", "red", "purple", "grey"),
labels = c(
paste0("Beta [AIC: ",
round(2*beta.hat$objective + 2*length(beta.hat$par),3),"]"),
paste0("Normal [AIC: ",
round(2*norm.hat$objective + 2*length(norm.hat$par),3),"]"),
paste0("Gamma [AIC: ",
round(2*gamma.hat$objective + 2*length(gamma.hat$par),3),"]"),
paste0("Inv Gauss [AIC: ",
round(2*invgaus.hat$objective + 2*length(invgaus.hat$par),3),"]"),
paste0("Log-normal [AIC: ",
round(2*lnorm.hat$objective + 2*length(lnorm.hat$par),3),"]")))+
ggtitle("Clothing insulation level")
ggsave(paste0(figpath,"distribution_choice_1.png"),
width = 20,
height = 10,
units = "cm")
fit.gamma <- glm(clo ~ tOut + tInOp + sex,
data = c.data,
family = Gamma(link = "cloglog"))
add1(object = fit.gamma,
scope = ~.+tOut:sex+tInOp:sex+tOut:tInOp,
test = "Chisq")
fit.gamma <- update(fit.gamma, .~.+tOut:sex)
Anova(fit.gamma, type = "III", test = "LR")
add1(object = fit.gamma, scope = ~.+tInOp:sex+tOut:tInOp, test = "Chisq")
drop1(object = fit.gamma, test = "Chisq")
fit.gamma <- update(fit.gamma, .~.-tInOp)
anova(fit.gamma, test = "Chisq")
Anova(fit.gamma, type = "III", test = "LR")
#### goodness of fit:
pchisq(deviance(fit.gamma),
df = dim(c.data)[1] - length(coefficients(fit.gamma)),
lower.tail = F) #=> response distribution, link and eta is appropriate
summary(fit.gamma)
rm(list=ls())
library(GGally)
library(qqplotr)
library(corrplot)
library(car)
library(reshape)
library(tidyverse)
library(magrittr)
library(dplyr)
library(betareg)
library(statmod)
library(jtools)
library(numDeriv)
library(latex2exp)
library(broom.mixed)
library(car)
library(gridExtra)
library(MASS)
library(data.table)
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/")
}
# Look at data
data <- as.data.table(read.table("Assignment 2/earinfect.txt", header = T))
summary(data)
data[,sum(persons), by = swimmer]
data[, sum(persons), by =location]
data[, sum(persons), by=age]
data[, sum(persons), by = sex]
data[persons == max(persons)]
data[,freq := infections/persons]
data[freq==max(freq)]
# Load of data
earinfect <- read.table("Assignment 2/earinfect.txt", header = T)
head(earinfect)
earinfect$swimmer <- factor(earinfect$swimmer)
earinfect$location <- factor(earinfect$location)
earinfect$age <- factor(earinfect$age, ordered = T)
earinfect$sex <- factor(earinfect$sex)
earinfect$healthy <- earinfect$persons - earinfect$infections
# Plots -------------------------------------------------------------------
hist(earinfect$infections)
ggpairs(earinfect)
ggplot(earinfect) +
geom_histogram(aes(x = infections, y = after_stat(density)), bins = 15,  colour = "white", position = "identity", alpha = 0.4) +
theme_bw() +
labs(y = "", colour = "Distribution", title = "Earinfections")
ggsave(file.path(getwd(), "Assignment 2/figs/earinfect.png"), width = 20, height = 10, units = "cm")
# Is there any difference in mean and variance of infections variable?
mean(earinfect$infections)
var(earinfect$infections)
fit.pois <- glm(infections ~ offset(persons) * age * sex * location * swimmer,
data = earinfect, family = poisson(link = 'log'))
fit.pois_full <- fit.pois
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
coefficients(fit.pois)
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Drop the largest interaction
fit.pois <- update(fit.pois, .~.-age:sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:sex:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Looks good now
summary(fit.pois)
str(earinfect)
earinfect$age
fit.pois
fit.pois$method
fit.pois$coefficients
fit.pois$fitted.values
fit.pois$effects
fit.pois$linear.predictors
fit.pois$R
# Load of data
earinfect <- read.table("Assignment 2/earinfect.txt", header = T)
head(earinfect)
earinfect$swimmer <- factor(earinfect$swimmer)
earinfect$location <- factor(earinfect$location)
earinfect$age <- factor(earinfect$age, ordered = F)
earinfect$sex <- factor(earinfect$sex)
earinfect$healthy <- earinfect$persons - earinfect$infections
# Plots -------------------------------------------------------------------
hist(earinfect$infections)
ggpairs(earinfect)
ggplot(earinfect) +
geom_histogram(aes(x = infections, y = after_stat(density)), bins = 15,  colour = "white", position = "identity", alpha = 0.4) +
theme_bw() +
labs(y = "", colour = "Distribution", title = "Earinfections")
ggsave(file.path(getwd(), "Assignment 2/figs/earinfect.png"), width = 20, height = 10, units = "cm")
# Is there any difference in mean and variance of infections variable?
mean(earinfect$infections)
var(earinfect$infections)
fit.pois <- glm(infections ~ offset(persons) * age * sex * location * swimmer,
data = earinfect, family = poisson(link = 'log'))
fit.pois_full <- fit.pois
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
coefficients(fit.pois)
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Drop the largest interaction
fit.pois <- update(fit.pois, .~.-age:sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:sex:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Looks good now
summary(fit.pois)
rm(list=ls())
library(GGally)
library(qqplotr)
library(corrplot)
library(car)
library(reshape)
library(tidyverse)
library(magrittr)
library(dplyr)
library(betareg)
library(statmod)
library(jtools)
library(numDeriv)
library(latex2exp)
library(broom.mixed)
library(car)
library(gridExtra)
library(MASS)
library(data.table)
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/")
}
# Look at data
data <- as.data.table(read.table("Assignment 2/earinfect.txt", header = T))
summary(data)
data[,sum(persons), by = swimmer]
data[, sum(persons), by =location]
data[, sum(persons), by=age]
data[, sum(persons), by = sex]
data[persons == max(persons)]
data[,freq := infections/persons]
data[freq==max(freq)]
# Load of data
earinfect <- read.table("Assignment 2/earinfect.txt", header = T)
head(earinfect)
earinfect$swimmer <- factor(earinfect$swimmer)
earinfect$location <- factor(earinfect$location)
earinfect$age <- factor(earinfect$age)
earinfect$sex <- factor(earinfect$sex)
earinfect$healthy <- earinfect$persons - earinfect$infections
earinfect$healthy <- earinfect$persons - earinfect$infections
# Plots -------------------------------------------------------------------
hist(earinfect$infections)
ggpairs(earinfect)
ggplot(earinfect) +
geom_histogram(aes(x = infections, y = after_stat(density)), bins = 15,  colour = "white", position = "identity", alpha = 0.4) +
theme_bw() +
labs(y = "", colour = "Distribution", title = "Earinfections")
rm(list=ls())
library(GGally)
library(qqplotr)
library(corrplot)
library(car)
library(reshape)
library(tidyverse)
library(magrittr)
library(dplyr)
library(betareg)
library(statmod)
library(jtools)
library(numDeriv)
library(latex2exp)
library(broom.mixed)
library(car)
library(gridExtra)
library(MASS)
library(data.table)
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/")
}
# Look at data
data <- as.data.table(read.table("Assignment 2/earinfect.txt", header = T))
summary(data)
data[,sum(persons), by = swimmer]
data[, sum(persons), by =location]
data[, sum(persons), by=age]
data[, sum(persons), by = sex]
data[persons == max(persons)]
data[,freq := infections/persons]
data[freq==max(freq)]
# Load of data
earinfect <- read.table("Assignment 2/earinfect.txt", header = T)
head(earinfect)
earinfect$swimmer <- factor(earinfect$swimmer)
earinfect$location <- factor(earinfect$location)
earinfect$age <- factor(earinfect$age)
earinfect$sex <- factor(earinfect$sex)
earinfect$healthy <- earinfect$persons - earinfect$infections
# Plots -------------------------------------------------------------------
hist(earinfect$infections)
ggpairs(earinfect)
ggplot(earinfect) +
geom_histogram(aes(x = infections, y = after_stat(density)), bins = 15,  colour = "white", position = "identity", alpha = 0.4) +
theme_bw() +
labs(y = "", colour = "Distribution", title = "Earinfections")
ggsave(file.path(getwd(), "Assignment 2/figs/earinfect.png"), width = 20, height = 10, units = "cm")
# Is there any difference in mean and variance of infections variable?
mean(earinfect$infections)
var(earinfect$infections)
fit.pois <- glm(infections ~ offset(persons) * age * sex * location * swimmer,
data = earinfect, family = poisson(link = 'log'))
fit.pois_full <- fit.pois
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
coefficients(fit.pois)
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- glm(infections ~ offset(persons) * age * sex * location * swimmer,
data = earinfect, family = poisson(link = 'log'))
fit.pois_full <- fit.pois
fit.pois_full
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
coefficients(fit.pois)
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Drop the largest interaction
fit.pois <- update(fit.pois, .~.-age:sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:sex:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Looks good now
summary(fit.pois)
summary(fit.pois_full)
# Looks good now
summary(fit.pois)
confint(fit.pois)
rm(list=ls())
library(GGally)
library(qqplotr)
library(corrplot)
library(car)
library(reshape)
library(tidyverse)
library(magrittr)
library(dplyr)
library(betareg)
library(statmod)
library(jtools)
library(numDeriv)
library(latex2exp)
library(broom.mixed)
library(car)
library(gridExtra)
library(MASS)
library(data.table)
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/")
}
# Look at data
data <- as.data.table(read.table("Assignment 2/earinfect.txt", header = T))
summary(data)
data[,sum(persons), by = swimmer]
data[, sum(persons), by =location]
data[, sum(persons), by=age]
data[, sum(persons), by = sex]
data[persons == max(persons)]
data[,freq := infections/persons]
data[freq==max(freq)]
# Load of data
earinfect <- read.table("Assignment 2/earinfect.txt", header = T)
head(earinfect)
earinfect$swimmer <- factor(earinfect$swimmer)
earinfect$location <- factor(earinfect$location)
earinfect$age <- factor(earinfect$age)
earinfect$sex <- factor(earinfect$sex)
earinfect$healthy <- earinfect$persons - earinfect$infections
# Plots -------------------------------------------------------------------
hist(earinfect$infections)
ggpairs(earinfect)
ggplot(earinfect) +
geom_histogram(aes(x = infections, y = after_stat(density)), bins = 15,  colour = "white", position = "identity", alpha = 0.4) +
theme_bw() +
labs(y = "", colour = "Distribution", title = "Earinfections")
ggsave(file.path(getwd(), "Assignment 2/figs/earinfect.png"), width = 20, height = 10, units = "cm")
# Is there any difference in mean and variance of infections variable?
mean(earinfect$infections)
var(earinfect$infections)
fit.pois <- glm(infections ~ offset(persons) * age * sex * location * swimmer,
data = earinfect, family = poisson(link = 'log'))
fit.pois_full <- fit.pois
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
coefficients(fit.pois)
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
# Drop the largest interaction
fit.pois <- update(fit.pois, .~.-age:sex:location:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-age:sex:swimmer)
1 - pchisq(fit.pois$deviance, df = fit.pois$df.residual)
length(coefficients(fit.pois))
anova(fit.pois, test = "Chisq")
drop1(fit.pois, test = "Chisq")
fit.pois <- update(fit.pois, .~.-sex:location:swimmer)
fit.nb <- glm.nb(infections ~ persons + age * sex * location * swimmer,
data = earinfect)
