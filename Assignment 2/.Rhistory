beta0 <- solve(t(X0) %*% ISigma %*% X0) %*%
t(X0) %*% ISigma %*% y
# Estimated (hat-)values
yh <- X0%*%beta0
sigma.h2 <- t(y-yh)%*%ISigma%*%(y-yh)/
(6-4)
sigma.h2
# With R (lm)
M0 <- lm(y ~ factor(method)*x,weights=1/v)
beta0
coef(M0)
## Simplify model
M1 <- lm(y ~ factor(method):x,weights=1/v)
M2 <- lm(y ~ x,weights=1/v)
summary(M2)
## Simplify model
M1 <- lm(y ~ factor(method):x,weights=1/v)
summary(M1)
# And test
anova(M1,M0)
anova(M2,M0)
# Exercise 3.7 (book) ---------------------------------------------------------
data(anscombe)
# Exercise 3.7 (book) ---------------------------------------------------------
rm(list=ls())
data(anscombe)
force(anscombe)
y <- cbind(anscombe$y1,anscombe$y2)
y
y <- rbind(anscombe$y1,anscombe$y2)
y
y <- c(anscombe$y1,anscombe$y2)
y
y <- c(anscombe$y1,anscombe$y2,anscombe$y3,anscombe$y4)
y
x <- c(anscombe$x1,anscombe$x2,anscombe$x3,anscombe$x4)
y <- c(anscombe$y1,anscombe$y2,anscombe$y3,anscombe$y4)
data <- rep(1:4,each=length(anscombe$x2))
data
plot(y ~ x, col=data+1, pch = data+1)
x
plot(anscombe$y1 ~ anscombe$x1, col=1, pch = 1)
par(mfrow=c(2,2))
plot(anscombe$y1 ~ anscombe$x1, col=1, pch = 1)
plot(anscombe$y2 ~ anscombe$x2, col=2, pch = 2)
plot(anscombe$y3 ~ anscombe$x3, col=3, pch = 3)
plot(anscombe$y4 ~ anscombe$x4, col=4, pch = 4)
##################################################
# Exercise 3.7
##################################################
data(anscombe)
M1 <- lm(y1 ~ x1, data=anscombe)
M2 <- lm(y2 ~ x2, data=anscombe)
M3 <- lm(y3 ~ x3, data=anscombe)
M4 <- lm(y4 ~ x4, data = anscombe)
summary(M1)
summary(M2)
summary(M3)
summary(M4)
# but have a look at residual plots
par(mfrow=c(2,2))
plot(M1) # ok.
par(mfrow=c(2,2))
plot(M2) # Not ok, missing a second order term
plot(anscombe$x2,residuals(M2))
M22 <- update(M2,.~.+I(x2^2))
par(mfrow=c(2,2))
plot(M22)
par(mfrow=c(2,2))
plot(M3) # Not ok. one outlier
plot(anscombe$x3,anscombe$y3)
par(mfrow=c(2,2))
plot(M4) # Not ok, no exertation of covariate
plot(y4~x4,data = anscombe)
plot(y1~x1,data = anscombe)
plot(y2~x2,data = anscombe)
plot(y3~x3,data = anscombe)
plot(y4~x4,data = anscombe)
# but have a look at residual plots
par(mfrow=c(2,2))
plot(M1) # ok.
par(mfrow=c(2,2))
plot(M2) # Not ok, missing a second order term
plot(anscombe$x2,residuals(M2))
M22 <- update(M2,.~.+I(x2^2))
par(mfrow=c(2,2))
plot(M22)
par(mfrow=c(2,2))
plot(M3) # Not ok. one outlier
plot(anscombe$x3,anscombe$y3)
par(mfrow=c(2,2))
plot(M4) # Not ok, no exertation of covariate
plot(y4~x4,data = anscombe)
plot(y1~x1,data = anscombe)
plot(y2~x2,data = anscombe)
plot(y3~x3,data = anscombe)
par(mfrow=c(2,2))
plot(y1~x1,data = anscombe)
plot(y2~x2,data = anscombe)
plot(y3~x3,data = anscombe)
plot(y4~x4,data = anscombe)
m1 <- lm(anscombe$y1 ~ anscombe$x1)
m2 <- lm(anscombe$y2 ~ anscombe$x2)
m3 <- lm(anscombe$y3 ~ anscombe$x3)
m4 <- lm(anscombe$y4 ~ anscombe$x4)
plot(m1)
plot(m1) # OK
plot(m2)
plot(m3)
plot(m4)
rm(list=ls())
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/")
}
library(data.table)
library(ggplot2)
library(GGally)
#load data
data <- data.table(read.csv("clothing.csv",header=TRUE))
# Look at data
head(data)
tail(data)
summary(data)
# Remove index column
data$X <- NULL
ggpairs(data)
par(mfrow=c(2,3))
plot(clo~tOut,data=data,main="tOut")
plot(clo~tInOp,data=data,main="tInOp")
boxplot(clo~sex,data=data,main="sex")
boxplot(clo~subjId,data=data,main="subjId")
plot(clo~time,data=data,main="time")
boxplot(clo~day,data=data,main="day")
# Based on the plot:
#   - There seems to be a correlation between temperature and clothing
#   - Also seems to be effect of sex
#   - No effect from day or time or subjId
# Question: Does it make sense to use subjid???
# Let's look at y before choosing distribution
data$clo
# Values between 0 and 1 - kind of like percentage?
#     - Can't use binomial since it is counting number of successes
#     - According to the internet, use beta distribution
# Correction: according to ?binomial, the y-vector can be given as a numerical vector
# with values between 0 and 1 (proportion of successful cases). Though, then I have to give
# the total number of cases in weights (????)
# It is wrong to set the number of trials to 100, because it is used to calculate p values.
# I try it anyways:
data$weight <- 100
fit0 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"), weights = data$weight)
summary(fit0)
# All parameters are significant, which I don't believe.
# When not specifying trials:
fit1 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"))
summary(fit1)
# Not all parameters are significant, which is more reasonable
# Remove 'day'
fit2 <- glm(clo ~ tOut + tInOp + sex + time, data = data,
family = binomial(link = "logit"))
summary(fit2)
# Remove 'tInOp'
fit3 <- glm(clo ~ tOut + sex + time, data = data,
family = binomial(link = "logit"))
summary(fit3)
# Remove 'time'
fit4 <- glm(clo ~ tOut + sex, data = data,
family = binomial(link = "logit"))
summary(fit4)
(pval <- 1 - pchisq(67.333,800))
# Good
par(mfrow=c(2,2))
plot(fit4)
par(mfrow=c(2,3))
plot(clo~tOut,data=data,main="tOut")
plot(clo~tInOp,data=data,main="tInOp")
boxplot(clo~sex,data=data,main="sex")
boxplot(clo~subjId,data=data,main="subjId")
plot(clo~time,data=data,main="time")
boxplot(clo~day,data=data,main="day")
betafit0 <- betareg(clo ~ tOut + tInOp + sex, data = data, link = "logit")
# Use betaregression
library(betareg)
betafit0 <- betareg(clo ~ tOut + tInOp + sex, data = data, link = "logit")
summary(betafit0)
plot(betafit0)
par(mfrow=c(2,2))
plot(betafit0)
qq(betafit0)
qqplot(betafit0)
qqplot(betafit0$residuals)
betafit0$residuals
qqnorm(betafit0$residuals)
par(mfrow=c(3,2))
qqnorm(betafit0$residuals)
qqline(betafit0$residuals)
par(mfrow=c(3,2))
b
plot(betafit0)
qqnorm(betafit0$residuals)
qqline(betafit0$residuals)
plot(data$tOut,res)
res <- betafit0$residuals
qqnorm(res)
qqline(res)
plot(data$tOut,res)
plot(data$tIn,res)
plot(data$sex,res)
data$sex
res
plot(data$sex,res)
plot(factor(data$sex),res)
add1(betafit0, scope=~.+ tOut*tInOp*sex,test="chisq")
betafit1 <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2) + I(tIn^2) + I(tOut*tIn) + I(tOut^(-2)), data = data, link = "logit")
betafit1 <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2) + I(tInOp^2) + I(tOut*tInOp) + I(tOut^(-2)), data = data, link = "logit")
betafit1 <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2), data = data, link = "logit")
betafit1
summary(betafit1)
betafit1a <- betareg(clo ~ tInOp + sex + I(tOut^2), data = data, link = "logit")
summary(betafit1a)
res <- betafit1a$residuals
qqnorm(res)
qqline(res)
plot(betafit1a)
res <- betafit1a$residuals
qqnorm(res)
qqline(res)
betafit2 <- betareg(clo ~ tOut + tInOp + sex + I(tInOp^2), data = data, link = "logit")
summary(betafit2)
library(car)
betafitALL <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2) + I(tInOp^2) + I(tOut*tInOp) + I(tOut^(-2)), data = data, link = "logit")
summary(betafitALL)
Anova(betafitALL,type = "III")
betafit2 <- betareg(clo ~ tOut + tInOp + sex + I(tInOp^2) + I(tOut*tInOp), data = data, link = "logit")
summary(betafit2)
Anova(betafit2,type = "III")
betafit3 <- betareg(clo ~ tOut + tInOp + sex + I(tInOp^2) , data = data, link = "logit")
summary(betafit3)
Anova(betafit3,type = "III")
betafit4 <- betareg(clo ~ tOut + sex + I(tInOp^2) , data = data, link = "logit")
summary(betafit4)
Anova(betafit4,type = "III")
plot(betafit4)
par(mfrow=c(2,3))
plot(betafit4)
res <- betafit4$residuals
qqnorm(res)
qqline(res)
AIC(betafit4)
AIC(betafit0)
betafit0
summary(betafit0)
predict(betafit4,type="link")
predict(betafit4,type="response")
pred4 <- predict(betafit4,type="response")
pred4
data$clo
plot(data$clo)
points(data$clo, color='red')
points(data$clo, col='red')
points(data$clo, col='r')
points(data$clo, col='red')
plot(data$clo)
points(pred4, col='red')
plot(data$clo)
points(pred4, col='red')
plot(data$clo,pred4)
betafit4 <- betareg(clo ~ tOut + sex + I(tInOp^2) , data = data)
betafit4
betafit4a <- betareg(clo ~ tOut + sex + I(tInOp^2) , data = data)
betafit4 <- betareg(clo ~ tOut + sex + I(tInOp^2) , data = data, link = "logit")
betafit4
betafit4a
pred4 <- predict(betafit4,type="response")
data$clo
plot(data$clo,pred4)
points(pred4, col='red')
par(mfrow=c(1,1))
plot(data$clo,pred4)
points(pred4, col='red')
plot(data$clo,pred4)
points(pred4, col='red')
pred4 <- predict(betafit4,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo,pred4)
points(pred4, col='red')
pred4
plot(data$clo)
points(pred4, col='red')
max(pred4)
pred0 <- predict(betafit0,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo)
points(pred0, col='red')
rm(list=ls())
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/")
}
library(data.table)
library(ggplot2)
library(GGally)
library(car)
#load data
data <- data.table(read.csv("clothing.csv",header=TRUE))
# Look at data
head(data)
tail(data)
summary(data)
# Remove index column
data$X <- NULL
ggpairs(data)
par(mfrow=c(2,3))
plot(clo~tOut,data=data,main="tOut")
plot(clo~tInOp,data=data,main="tInOp")
boxplot(clo~sex,data=data,main="sex")
boxplot(clo~subjId,data=data,main="subjId")
plot(clo~time,data=data,main="time")
boxplot(clo~day,data=data,main="day")
# Based on the plot:
#   - There seems to be a correlation between temperature and clothing
#   - Also seems to be effect of sex
#   - No effect from day or time or subjId
# Question: Does it make sense to use subjid???
# Let's look at y before choosing distribution
data$clo
# Values between 0 and 1 - kind of like percentage?
#     - Can't use binomial since it is counting number of successes
#     - According to the internet, use beta distribution
# Correction: according to ?binomial, the y-vector can be given as a numerical vector
# with values between 0 and 1 (proportion of successful cases). Though, then I have to give
# the total number of cases in weights (????)
# It is wrong to set the number of trials to 100, because it is used to calculate p values.
# I try it anyways:
data$weight <- 100
fit0 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"), weights = data$weight)
summary(fit0)
# All parameters are significant, which I don't believe.
# When not specifying trials:
fit1 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"))
summary(fit1)
# Not all parameters are significant, which is more reasonable
predf1 <- predict(fit1,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo)
points(pred1, col='red')
points(predf1, col='red')
predf0 <- predict(fit0,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo)
points(predf0, col='red')
# When not specifying trials:
fit1 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"))
summary(fit1)
# When not specifying trials:
fit1 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"))
summary(fit1)
predf1 <- predict(fit1,type="response")
par(mfrow=c(1,1))
plot(data$clo)
points(predf1, col='red')
predf0 <- predict(fit0,type="response")
par(mfrow=c(1,1))
plot(data$clo)
points(predf0, col='red')
betafit4
rm(list=ls())
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/")
}
library(data.table)
library(ggplot2)
library(GGally)
library(car)
#load data
data <- data.table(read.csv("clothing.csv",header=TRUE))
# Look at data
head(data)
tail(data)
summary(data)
# Remove index column
data$X <- NULL
ggpairs(data)
par(mfrow=c(2,3))
plot(clo~tOut,data=data,main="tOut")
plot(clo~tInOp,data=data,main="tInOp")
boxplot(clo~sex,data=data,main="sex")
boxplot(clo~subjId,data=data,main="subjId")
plot(clo~time,data=data,main="time")
boxplot(clo~day,data=data,main="day")
# Based on the plot:
#   - There seems to be a correlation between temperature and clothing
#   - Also seems to be effect of sex
#   - No effect from day or time or subjId
# Question: Does it make sense to use subjid???
# Let's look at y before choosing distribution
data$clo
# Values between 0 and 1 - kind of like percentage?
#     - Can't use binomial since it is counting number of successes
#     - According to the internet, use beta distribution
# Correction: according to ?binomial, the y-vector can be given as a numerical vector
# with values between 0 and 1 (proportion of successful cases). Though, then I have to give
# the total number of cases in weights (????)
# It is wrong to set the number of trials to 100, because it is used to calculate p values.
# I try it anyways:
data$weight <- 100
fit0 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"), weights = data$weight)
summary(fit0)
# All parameters are significant, which I don't believe.
# When not specifying trials:
fit1 <- glm(clo ~ tOut + tInOp + sex + time + day, data = data,
family = binomial(link = "logit"))
summary(fit1)
# Not all parameters are significant, which is more reasonable
predf1 <- predict(fit1,type="response")
plot(data$clo)
points(predf1, col='red')
predf0 <- predict(fit0,type="response")
plot(data$clo)
points(predf0, col='red')
# Use betaregression
library(betareg)
betafit0 <- betareg(clo ~ tOut + tInOp + sex, data = data, link = "logit")
summary(betafit0)
plot(betafit0)
res <- betafit0$residuals
qqnorm(res)
qqline(res)
# betafit0 seems good
plot(data$tOut,res)
plot(data$tIn,res)
plot(factor(data$sex),res)
betafitALL <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2) + I(tInOp^2) + I(tOut*tInOp) + I(tOut^(-2)), data = data, link = "logit")
summary(betafitALL)
Anova(betafitALL,type = "III")
betafit1 <- betareg(clo ~ tOut + tInOp + sex + I(tOut^2), data = data, link = "logit")
summary(betafit1)
betafit2 <- betareg(clo ~ tOut + tInOp + sex + I(tInOp^2) + I(tOut*tInOp), data = data, link = "logit")
summary(betafit2)
Anova(betafit2,type = "III")
betafit3 <- betareg(clo ~ tOut + tInOp + sex + I(tInOp^2) , data = data, link = "logit")
summary(betafit3)
Anova(betafit3,type = "III")
betafit4 <- betareg(clo ~ tOut + sex + I(tInOp^2) , data = data, link = "logit")
summary(betafit4)
Anova(betafit4,type = "III")
par(mfrow=c(2,3))
plot(betafit4)
res <- betafit4$residuals
qqnorm(res)
qqline(res)
# betafit4 seems good
AIC(betafit4)
AIC(betafit0)
# Plot predictions
pred4 <- predict(betafit4,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo)
points(pred4, col='red')
# Not overwhelming:((((
max(pred4)
pred0 <- predict(betafit0,type="response")
data$clo
par(mfrow=c(1,1))
plot(data$clo)
points(pred0, col='red')
betafit4
summary(betafit4)
rm(list=ls())
if (Sys.getenv('USER') == "mortenjohnsen"){
setwd("/Users/mortenjohnsen/OneDrive - Danmarks Tekniske Universitet/DTU/10. Semester/02424 - Advanced Dataanalysis and Statistical Modellling/02424---Assignments/Assignment 2/")
}else if (Sys.getenv('USER') == "freja"){
setwd("~/Documents/Uni/TiendeSemester/Adv. data analysis and stat. modelling/02424---Assignments/Assignment 2")
}else{
setwd("C:/Users/catdu/OneDrive/DTU/10. semester/Advanced Dataanalysis and Statistical Modelling/Assignment 1/02424---Assignments/Assignment 2/")
}
library(data.table)
#load data
data <- data.table(read.table("earinfect.txt",header=TRUE))
# Look at data
head(data)
summary(data)
data[,sum(persons), by = swimmer]
data[, sum(persons), by =location]
data[, sum(persons), by=age]
data[, sum(persons), by = sex]
data[persons == max(persons)]
data[,freq := infections/persons]
data[freq==max(freq)]
data
